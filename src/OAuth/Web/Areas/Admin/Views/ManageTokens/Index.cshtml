@model AlwaysMoveForward.OAuth.Web.Areas.Admin.Models.OAuthTokensModel
@{
    ViewBag.Title = "OAuth Tokens";
    ViewBag.SelectedTab = 4;
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}
@section headerPlugins
{
    <script src="@Url.Content("~/Scripts/Controllers/RequestTokenController.js")" type="text/javascript"></script>
    <link href="@Url.Content("~/Content/Pager.css")" rel="stylesheet" type="text/css" />
    <script src="~/Scripts/datepicker/js/bootstrap-datepicker.js"></script>
    <script type="text/javascript">
        $(function () {
            $('#startDatePicker').datepicker({
                format: 'mm-dd-yyyy'
            }).on('changeDate', function(ev){
                $('#startDate').val(ev.date.valueOf());
            });

            $('#endDatePicker').datepicker({
                format: 'mm-dd-yyyy'
            }).on('changeDate', function (ev) {
                $('#endDate').val(ev.date.valueOf());
            });
        });
    </script>
}
<div class="bodyContent" ng-controller="RequestTokenController">
    <div>
        <form id="searchForm" action="/Admin/ManageTokens/Index">
            <span class="label">Search for:</span>

            <div>
                <span class="label">Username</span>
                <input type="text" name="userName" id="userName" value="@Model.UserName" ng-model="searchForm.userName" ng-init="searchForm.userName='@Model.UserName'"/>
            </div>
            <div>
                <span class="label">Consumer Key</span>
                <input type="text" name="consumerKey" id="consumerKey" value="@Model.ConsumerKey" ng-model="searchForm.consumerKey" ng-init="searchForm.consumerKey='@Model.ConsumerKey'" />
            </div>
            <div>
                <span class="label">Start Date</span>
                <input type="text" class="datepicker" id="startDatePicker" name="startDatePicker" value="@Model.StartDate" ng-model="searchForm.startDate" ng-init="searchForm.startDate='@Model.StartDate'" />
                <input type="hidden" id="startDate" name="startDate" value="@Model.StartDate" />
            </div>
            <div>
                <span class="label">End Date</span>
                <input type="text" class="datepicker" id="endDatePicker" name="endDatePicker" value="@Model.EndDate" ng-model="searchForm.endDate" ng-init="searchForm.endDate='@Model.EndDate'" />
                <input type="hidden" id="endDate" name="endDate" value="@Model.EndDate" />
            </div>
            <button type="button" id="searchFormSubmitButton" class="btn-sm btn-primary" ng-click="getTokens()">Search</button>
        </form>
    </div>
    <div class="panel panel-primary">
        <div class="panel-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Consumer</th>
                        <th>Request Token</th>
                        <th>Realm</th>
                        <th>Request Token Created</th>
                        <th>Request Token State</th>
                        <th>Request Token Authorization</th>
                        <th>Access Token</th>
                        <th>Access Token Grant</th>
                        <th>Access Token Expiration</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody ng-repeat="requestToken in requestTokens">
                    <tr>
                        <td>{{requestToken.ConsumerKey}}</td>
                        <td>{{requestToken.Token}}</td>
                        <td>{{requestToken.Realm.ToString()}}</td>
                        <td>{{requestToken.DateCreated}}</td>
                        <td>{{requestToken.State}}</td>
                        <td>{{angular.IsDate(requestToken.DateAuthorized)}}</td>
                        <td>{{!angular.IsUndefined(requestToken.AccessToken.Token)}}</td>
                        <td>{{requestToken.AccessToken.DateGranted}}</td>
                        <td>{{requestToken.AccessToken.ExpirationDate}}</td>
                        <td>
                            <a ng-click="deleteRequestToken(requestToken.Id)"><img src="/Content/Images/delete.png" height="50" width="50"/></a>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="pager">
                <span ng-if="requestTokens.PageNumber==0" class="disabled">&lt;</span>
                <a ng-click="getTokens()" ng-if="requestTokens.PageNumber > 0">&lt;</a>

                <span ng-repeat="n in pages(5)">
                    <span class="current" ng-if="requestTokens.PageNumber==$index">{{$index}}</span>
                    <a ng-if="requestTokens.PageNumber!=$index" ng-click="getTokensByPage($index)">{{$index}}</a>
                </span>
            </div>
        </div>
    </div>
</div>


