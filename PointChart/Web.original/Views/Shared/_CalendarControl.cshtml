@model AlwaysMoveForward.PointChart.Web.Models.CalendarModel
@using AlwaysMoveForward.AnotherBlog.Web
<div class="contentSection">
    <div class="monthTitle">
        <a class="changeMonth" href="@Model.GenerateUrlForMonth(-1)"> &lt; </a>
        <a class="currentMonth" href="@Model.GenerateUrlForMonth(0)">@Model.TargetMonth.ToString("MMMM")</a>
        <a class="changeMonth" href="@Model.GenerateUrlForMonth(1)"> &gt; </a>
    </div> 
    @{
        DateTime currentWeekStart = AlwaysMoveForward.Common.Utilities.Utils.DetermineStartOfWeek(@Model.ViewDate);
        
        DateTime trackingDate = @Model.TargetMonth;
        trackingDate = trackingDate.AddDays(-(ViewData.Model.TargetMonth.Day - 1));
        trackingDate = AlwaysMoveForward.Common.Utilities.Utils.DetermineStartOfWeek(trackingDate);        
    }
    <table class="calendarDates">

    @for (int weekIndex = 0; weekIndex < 6; weekIndex++)
    {
        <tr class=\"weekRow\">

        @for(int i= 0; i < 7; i++)
        {
            string cellHtml = "<td class=\"weekDayCell";
            
            if (trackingDate.Month == ViewData.Model.TargetMonth.Month)
            {
                cellHtml += " weekDayCellThisMonth";
            }
            else
            {
                cellHtml += " weekdayCellOtherMonth";
            }

            if (trackingDate.Date.AddDays(-i).Date == currentWeekStart.Date)
            {
                cellHtml += " weekDayCellCurrentWeek";
            }
            
            if (trackingDate.Date == DateTime.Now.Date)
            {
                cellHtml += " weekDayCellCurrentDay";
            }
            
            cellHtml += "\"><a href='" + Model.GenerateUrlForDay(trackingDate) + "'>" + trackingDate.Day.ToString() + "</a></td>";

            @Html.Raw(cellHtml);
            trackingDate = trackingDate.AddDays(1);                    
        }

        </tr>
    }
   </table>
</div>
